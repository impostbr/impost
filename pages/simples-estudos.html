<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IMPOST. â€” Estudo TributÃ¡rio Simples Nacional</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMPOST. â€” Design System (Paleta Verde/Branco)
   Inspirado no layout do Lucro Real do IMPOST.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --pri:#16a34a;--pri-dk:#15803d;--pri-dkr:#166534;--pri-lt:#bbf7d0;--pri-bg:#f0fdf4;
  --pri-50:#f0fdf4;--pri-100:#dcfce7;--pri-200:#bbf7d0;--pri-300:#86efac;--pri-400:#4ade80;--pri-500:#22c55e;--pri-600:#16a34a;--pri-700:#15803d;--pri-800:#166534;--pri-900:#14532d;
  --accent:#f59e0b;--accent-lt:#fef3c7;
  --ok:#059669;--ok-lt:#d1fae5;
  --danger:#dc2626;--danger-lt:#fee2e2;
  --warn:#d97706;--warn-lt:#fef9c3;
  --info:#0284c7;--info-lt:#e0f2fe;
  --bg:#f8fafb;--card:#ffffff;
  --txt:#1a2e1a;--txt2:#4a6741;--txt3:#7c9a72;
  --brd:#d4e8d0;--brd2:#b8d4b2;
  --radius:14px;--radius-sm:10px;--radius-xs:6px;
  --shadow:0 1px 3px rgba(22,101,52,.06),0 4px 16px rgba(22,101,52,.04);
  --shadow-md:0 4px 12px rgba(22,101,52,.08);
  --shadow-lg:0 8px 30px rgba(22,101,52,.1);
  --font:'Plus Jakarta Sans','Segoe UI',system-ui,sans-serif;
  --mono:'JetBrains Mono','Fira Code',ui-monospace,monospace;
}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--txt);line-height:1.65;-webkit-font-smoothing:antialiased}
input,select,textarea,button{font-family:inherit;font-size:inherit}

/* â”€â”€â”€ Header â”€â”€â”€ */
.site-header{background:linear-gradient(135deg,var(--pri-900) 0%,var(--pri-700) 50%,var(--pri-600) 100%);padding:18px 0;position:sticky;top:0;z-index:100;box-shadow:0 2px 20px rgba(22,101,52,.2)}
.header-inner{max-width:1140px;margin:0 auto;padding:0 28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.logo{font-size:28px;font-weight:800;color:#fff;letter-spacing:-1.5px}
.logo span{color:var(--accent)}
.tagline{font-size:12px;color:var(--pri-200);font-style:italic;max-width:360px;line-height:1.4}
.badge-sn{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.15);backdrop-filter:blur(8px);color:#fff;font-size:12px;font-weight:600;padding:6px 16px;border-radius:20px;border:1px solid rgba(255,255,255,.2)}

/* â”€â”€â”€ Progress Stepper â”€â”€â”€ */
.progress-bar{max-width:1140px;margin:0 auto;padding:28px 28px 0}
.progress-steps{display:flex;gap:0;position:relative}
.progress-step{flex:1;text-align:center;position:relative}
.progress-step .step-num{width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;border:2.5px solid var(--brd);color:var(--txt3);background:#fff;position:relative;z-index:2;transition:.3s}
.progress-step .step-label{display:block;font-size:11px;color:var(--txt3);margin-top:6px;font-weight:500;transition:.3s;line-height:1.3}
.progress-step.active .step-num{background:var(--pri);border-color:var(--pri);color:#fff;box-shadow:0 0 0 4px var(--pri-lt),0 2px 8px rgba(22,163,74,.3)}
.progress-step.active .step-label{color:var(--pri-dk);font-weight:700}
.progress-step.done .step-num{background:var(--ok);border-color:var(--ok);color:#fff}
.progress-step.done .step-num::after{content:'âœ“'}
.progress-step.done .step-label{color:var(--ok)}
.progress-line{position:absolute;top:20px;left:0;right:0;height:3px;background:var(--brd);z-index:1;border-radius:2px}
.progress-line-fill{height:100%;background:linear-gradient(90deg,var(--ok),var(--pri));border-radius:2px;transition:width .5s ease}

/* â”€â”€â”€ Container â”€â”€â”€ */
.container{max-width:1140px;margin:0 auto;padding:24px 28px 60px}

/* â”€â”€â”€ Wizard Card â”€â”€â”€ */
.wizard-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--brd)}
.step-panel{display:none;padding:36px;animation:fadeSlide .4s ease}
.step-panel.active{display:block}
@keyframes fadeSlide{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€ Step Header â”€â”€â”€ */
.step-header{margin-bottom:28px;display:flex;align-items:flex-start;gap:16px}
.step-icon{width:48px;height:48px;border-radius:12px;background:var(--pri-100);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.step-header-text h2{font-size:21px;font-weight:700;color:var(--txt);margin-bottom:2px}
.step-header-text p{font-size:14px;color:var(--txt2)}

/* â”€â”€â”€ Section Divider â”€â”€â”€ */
.section-title{font-size:16px;font-weight:700;color:var(--pri-dk);margin:28px 0 16px;padding-left:12px;border-left:3px solid var(--pri);display:flex;align-items:center;gap:8px}
.section-title .st-sub{font-size:12px;font-weight:500;color:var(--txt3)}

/* â”€â”€â”€ Form Fields â”€â”€â”€ */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
.form-row.col-1{grid-template-columns:1fr}
.form-row.col-3{grid-template-columns:1fr 1fr 1fr}
.form-row.col-4{grid-template-columns:1fr 1fr 1fr 1fr}
@media(max-width:768px){.form-row,.form-row.col-3,.form-row.col-4{grid-template-columns:1fr}}
.form-group{display:flex;flex-direction:column}
.form-group label{font-size:13px;font-weight:600;color:var(--txt);margin-bottom:5px;display:flex;align-items:center;gap:6px}
.form-group label .req{color:var(--danger);font-size:10px}
.form-group input,.form-group select,.form-group textarea{padding:10px 14px;border:1.5px solid var(--brd);border-radius:var(--radius-xs);font-size:15px;color:var(--txt);background:#fff;transition:.2s;outline:none;width:100%}
.form-group input:focus,.form-group select:focus{border-color:var(--pri);box-shadow:0 0 0 3px var(--pri-100)}
.form-group input.error{border-color:var(--danger);box-shadow:0 0 0 3px var(--danger-lt)}
.form-group input.valid{border-color:var(--ok)}
.form-group .hint{font-size:11.5px;color:var(--txt3);margin-top:4px;line-height:1.4}
.form-group .error-msg{font-size:12px;color:var(--danger);margin-top:3px;display:none}
.form-group .error-msg.show{display:block}
.money-input{font-family:var(--mono);font-weight:500;letter-spacing:.3px}

/* â”€â”€â”€ Tooltip / Sigla â”€â”€â”€ */
.sigla{cursor:help;position:relative;border-bottom:1px dashed var(--pri);color:var(--pri-dk);font-weight:600}
.sigla:hover::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:var(--pri-900);color:#fff;font-size:12px;font-weight:400;padding:10px 14px;border-radius:8px;white-space:normal;max-width:320px;min-width:200px;z-index:50;box-shadow:var(--shadow-lg);line-height:1.45;pointer-events:none}
.sigla:hover::before{content:'';position:absolute;bottom:calc(100% + 2px);left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--pri-900);z-index:51}
.tooltip-icon{display:inline-flex;align-items:center;justify-content:center;width:17px;height:17px;border-radius:50%;background:var(--pri-100);color:var(--pri-dk);font-size:10px;font-weight:700;cursor:help;position:relative;flex-shrink:0}
.tooltip-icon:hover::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:var(--pri-900);color:#fff;font-size:12px;font-weight:400;padding:10px 14px;border-radius:8px;white-space:normal;max-width:320px;min-width:200px;z-index:50;box-shadow:var(--shadow-lg);line-height:1.45}

/* â”€â”€â”€ Info Cards â”€â”€â”€ */
.info-card{border-radius:var(--radius-sm);padding:14px 16px;margin:14px 0;display:flex;gap:12px;align-items:flex-start;font-size:13.5px;line-height:1.5}
.info-card.info{background:var(--pri-50);border:1px solid var(--pri-200)}
.info-card.warn{background:var(--warn-lt);border:1px solid #fcd34d}
.info-card.danger{background:var(--danger-lt);border:1px solid #fca5a5}
.info-card.success{background:var(--ok-lt);border:1px solid #6ee7b7}
.info-card .ic-icon{font-size:18px;flex-shrink:0;margin-top:1px}
.info-card .ic-title{font-weight:700;margin-bottom:2px}
.info-card .ic-ref{font-size:11px;color:var(--txt3);margin-top:4px;font-style:italic}

/* â”€â”€â”€ Toggle â”€â”€â”€ */
.toggle-wrap{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.toggle{position:relative;width:44px;height:24px;background:var(--brd2);border-radius:12px;cursor:pointer;transition:.25s;flex-shrink:0}
.toggle.on{background:var(--pri)}
.toggle::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.25s;box-shadow:0 1px 3px rgba(0,0,0,.15)}
.toggle.on::after{left:23px}
.toggle-label{font-size:14px;color:var(--txt);font-weight:500}
.toggle-sub{font-size:11.5px;color:var(--txt3);display:block}

/* â”€â”€â”€ Buttons â”€â”€â”€ */
.btn-row{display:flex;justify-content:space-between;align-items:center;padding:24px 36px;background:var(--pri-50);border-top:1px solid var(--brd)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:11px 24px;border-radius:var(--radius-xs);font-size:14px;font-weight:600;cursor:pointer;border:none;transition:.2s}
.btn-primary{background:var(--pri);color:#fff;box-shadow:0 2px 8px rgba(22,163,74,.25)}
.btn-primary:hover{background:var(--pri-dk);box-shadow:0 4px 14px rgba(22,163,74,.3);transform:translateY(-1px)}
.btn-secondary{background:#fff;color:var(--pri-dk);border:1.5px solid var(--brd)}
.btn-secondary:hover{border-color:var(--pri);background:var(--pri-50)}
.btn-danger{background:var(--danger);color:#fff}
.btn-danger:hover{background:#b91c1c}
.btn:disabled{opacity:.45;cursor:not-allowed;transform:none!important}
.btn-sm{padding:7px 16px;font-size:13px}

/* â”€â”€â”€ Tables â”€â”€â”€ */
.table-wrap{overflow-x:auto;margin:12px 0;border-radius:var(--radius-sm);border:1px solid var(--brd)}
table{width:100%;border-collapse:collapse;font-size:13.5px}
thead{background:var(--pri-50)}
th{padding:10px 14px;text-align:left;font-weight:600;color:var(--pri-dk);border-bottom:2px solid var(--pri-200);white-space:nowrap;font-size:12.5px;text-transform:uppercase;letter-spacing:.3px}
td{padding:10px 14px;border-bottom:1px solid var(--brd);color:var(--txt)}
tbody tr:hover{background:var(--pri-50)}
tbody tr:last-child td{border-bottom:none}
.td-mono{font-family:var(--mono);font-weight:500;font-size:13px}
.td-right{text-align:right}
.td-center{text-align:center}
.highlight-row{background:var(--pri-100)!important;font-weight:600}

/* â”€â”€â”€ Result Cards â”€â”€â”€ */
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin:16px 0}
.result-card{background:#fff;border:1px solid var(--brd);border-radius:var(--radius-sm);padding:18px;position:relative;overflow:hidden}
.result-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--pri)}
.result-card.gold::before{background:linear-gradient(90deg,#f59e0b,#eab308)}
.result-card.danger::before{background:var(--danger)}
.result-card .rc-label{font-size:12px;font-weight:600;color:var(--txt3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}
.result-card .rc-value{font-size:24px;font-weight:800;color:var(--txt);font-family:var(--mono);letter-spacing:-.5px}
.result-card .rc-sub{font-size:12px;color:var(--txt2);margin-top:4px}
.result-card .rc-ref{font-size:10.5px;color:var(--txt3);margin-top:8px;font-style:italic;border-top:1px solid var(--brd);padding-top:6px}

/* â”€â”€â”€ Regime Comparison Cards â”€â”€â”€ */
.regime-card{background:#fff;border:1.5px solid var(--brd);border-radius:var(--radius);padding:20px;position:relative;transition:.2s}
.regime-card.best{border-color:var(--pri);box-shadow:0 0 0 3px var(--pri-100)}
.regime-card.best::after{content:'ğŸ† Mais Vantajoso';position:absolute;top:-12px;right:16px;background:var(--pri);color:#fff;font-size:11px;font-weight:700;padding:3px 12px;border-radius:10px}
.regime-card .regime-name{font-size:16px;font-weight:700;margin-bottom:10px;color:var(--txt)}
.regime-card .regime-value{font-size:28px;font-weight:800;font-family:var(--mono);color:var(--pri-dk)}
.regime-card .regime-perc{font-size:14px;color:var(--txt2);margin-top:2px}
.regime-card .regime-detail{font-size:12.5px;color:var(--txt2);margin-top:12px;padding-top:10px;border-top:1px solid var(--brd);line-height:1.6}

/* â”€â”€â”€ Strategy Cards â”€â”€â”€ */
.strategy-card{background:#fff;border:1px solid var(--brd);border-radius:var(--radius-sm);padding:16px;margin-bottom:12px;transition:.2s}
.strategy-card:hover{box-shadow:var(--shadow-md);border-color:var(--pri-200)}
.strategy-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.strategy-badge{font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}
.strategy-badge.critico{background:#dc262620;color:#dc2626}
.strategy-badge.alto{background:#f59e0b20;color:#b45309}
.strategy-badge.medio{background:#0284c720;color:#0284c7}
.strategy-badge.baixo{background:#64748b20;color:#64748b}
.strategy-title{font-size:14px;font-weight:700;color:var(--txt)}
.strategy-body{font-size:13px;color:var(--txt2);line-height:1.5}
.strategy-steps{margin-top:8px;padding-left:18px;list-style:none}
.strategy-steps li{position:relative;padding:3px 0;font-size:12.5px;color:var(--txt2)}
.strategy-steps li::before{content:'â†’';position:absolute;left:-16px;color:var(--pri)}
.strategy-ref{font-size:11px;color:var(--txt3);font-style:italic;margin-top:6px}

/* â”€â”€â”€ Risk Cards â”€â”€â”€ */
.risk-card{border-left:4px solid;border-radius:0 var(--radius-xs) var(--radius-xs) 0;padding:12px 16px;margin-bottom:10px;background:#fff}
.risk-card.critica{border-color:var(--danger);background:var(--danger-lt)}
.risk-card.alta{border-color:var(--warn);background:var(--warn-lt)}
.risk-card.media{border-color:var(--info);background:var(--info-lt)}
.risk-card .risk-title{font-size:13.5px;font-weight:700}
.risk-card .risk-desc{font-size:12.5px;color:var(--txt2);margin-top:3px}
.risk-card .risk-prev{font-size:12px;color:var(--ok);font-weight:500;margin-top:4px}
.risk-card .risk-ref{font-size:11px;color:var(--txt3);font-style:italic;margin-top:4px}

/* â”€â”€â”€ Chart Container â”€â”€â”€ */
.chart-container{position:relative;height:320px;margin:16px 0;background:#fff;border-radius:var(--radius-sm);padding:16px;border:1px solid var(--brd)}
.chart-container canvas{max-height:300px}

/* â”€â”€â”€ Accordion â”€â”€â”€ */
.accordion{border:1px solid var(--brd);border-radius:var(--radius-sm);overflow:hidden;margin:10px 0}
.accordion-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--pri-50);cursor:pointer;font-size:14px;font-weight:600;color:var(--pri-dk);transition:.2s;user-select:none}
.accordion-header:hover{background:var(--pri-100)}
.accordion-header .arrow{transition:.3s;font-size:12px}
.accordion-header.open .arrow{transform:rotate(180deg)}
.accordion-body{padding:0 16px;max-height:0;overflow:hidden;transition:max-height .4s ease,padding .3s ease}
.accordion-body.open{padding:14px 16px;max-height:2000px}

/* â”€â”€â”€ Footer â”€â”€â”€ */
.site-footer{text-align:center;padding:32px 28px;font-size:12px;color:var(--txt3);border-top:1px solid var(--brd);margin-top:40px}
.site-footer strong{color:var(--pri-dk)}

/* â”€â”€â”€ Misc â”€â”€â”€ */
.hidden{display:none!important}
.text-pri{color:var(--pri)}
.text-ok{color:var(--ok)}
.text-warn{color:var(--warn)}
.text-danger{color:var(--danger)}
.font-mono{font-family:var(--mono)}
.fw-700{font-weight:700}
.mt-8{margin-top:8px}
.mt-16{margin-top:16px}
.mb-0{margin-bottom:0}
.gap-12{gap:12px}

/* â”€â”€â”€ Animations â”€â”€â”€ */
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.pulse{animation:pulse 2s infinite}
@keyframes slideDown{from{opacity:0;max-height:0}to{opacity:1;max-height:1000px}}

/* â”€â”€â”€ SÃ³cio row â”€â”€â”€ */
.socio-row{display:grid;grid-template-columns:1fr 100px 100px 40px;gap:10px;align-items:end;margin-bottom:10px}
.socio-row .btn-remove{width:36px;height:36px;border-radius:50%;border:1px solid var(--danger-lt);background:#fff;color:var(--danger);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-bottom:4px}
.socio-row .btn-remove:hover{background:var(--danger-lt)}

/* â”€â”€â”€ ObrigaÃ§Ãµes â”€â”€â”€ */
.obrig-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin:12px 0}
.obrig-card{background:#fff;border:1px solid var(--brd);border-radius:var(--radius-sm);padding:14px;font-size:13px}
.obrig-card .obrig-name{font-weight:700;color:var(--pri-dk);margin-bottom:4px;display:flex;align-items:center;gap:6px}
.obrig-card .obrig-period{font-size:11.5px;color:var(--txt3);margin-bottom:4px}
.obrig-card .obrig-prazo{font-size:12px;color:var(--txt2)}
.obrig-card .obrig-ref{font-size:10.5px;color:var(--txt3);font-style:italic;margin-top:6px}

/* â”€â”€â”€ Print â”€â”€â”€ */
@media print{
  .site-header,.btn-row,.progress-bar{display:none}
  .step-panel{display:block!important;break-inside:avoid;page-break-inside:avoid}
  body{background:#fff}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- HEADER                                              -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="site-header">
  <div class="header-inner">
    <div>
      <div class="logo">IMPOST<span>.</span></div>
      <div class="tagline">Porque pagar imposto certo Ã© direito. Pagar menos, legalmente, Ã© inteligÃªncia.</div>
    </div>
    <span class="badge-sn">ğŸ“Š Estudo TributÃ¡rio â€” Simples Nacional</span>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- PROGRESS BAR                                        -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="progress-bar">
  <div class="progress-steps">
    <div class="progress-line"><div class="progress-line-fill" id="progressFill" style="width:0%"></div></div>
    <div class="progress-step active" data-step="1">
      <span class="step-num">1</span>
      <span class="step-label">Dados da<br>Empresa</span>
    </div>
    <div class="progress-step" data-step="2">
      <span class="step-num">2</span>
      <span class="step-label">Receitas e<br>Faturamento</span>
    </div>
    <div class="progress-step" data-step="3">
      <span class="step-num">3</span>
      <span class="step-label">Folha e<br>Fator "r"</span>
    </div>
    <div class="progress-step" data-step="4">
      <span class="step-num">4</span>
      <span class="step-label">DeduÃ§Ãµes e<br>SegregaÃ§Ã£o</span>
    </div>
    <div class="progress-step" data-step="5">
      <span class="step-num">5</span>
      <span class="step-label">SÃ³cios e<br>Lucros</span>
    </div>
    <div class="progress-step" data-step="6">
      <span class="step-num">6</span>
      <span class="step-label">CenÃ¡rios e<br>Comparativo</span>
    </div>
    <div class="progress-step" data-step="7">
      <span class="step-num">7</span>
      <span class="step-label">RelatÃ³rio<br>Final</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- WIZARD                                              -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="container">
<div class="wizard-card">

<!-- â•â•â•â•â•â•â• ETAPA 1: DADOS DA EMPRESA â•â•â•â•â•â•â• -->
<div class="step-panel active" id="step1">
  <div class="step-header">
    <div class="step-icon">ğŸ¢</div>
    <div class="step-header-text">
      <h2>Etapa 1 de 7 â€” Dados da Empresa e Regime</h2>
      <p>InformaÃ§Ãµes bÃ¡sicas para enquadramento no Simples Nacional</p>
    </div>
  </div>

  <div class="section-title">IdentificaÃ§Ã£o <span class="st-sub">Dados cadastrais</span></div>

  <div class="form-row">
    <div class="form-group">
      <label>RazÃ£o Social / Nome Fantasia</label>
      <input type="text" id="nomeEmpresa" placeholder="Ex.: Minha Empresa Ltda">
    </div>
    <div class="form-group">
      <label><span class="sigla" data-tip="Cadastro Nacional da Pessoa JurÃ­dica â€” nÃºmero de identificaÃ§Ã£o da empresa perante a Receita Federal do Brasil">CNPJ</span></label>
      <input type="text" id="cnpj" placeholder="00.000.000/0000-00" maxlength="18">
    </div>
  </div>

  <div class="form-row col-3">
    <div class="form-group">
      <label>
        <span class="sigla" data-tip="ClassificaÃ§Ã£o Nacional de Atividades EconÃ´micas â€” cÃ³digo que identifica a atividade principal da empresa. Determina o Anexo do Simples Nacional. Base: ResoluÃ§Ã£o CGSN nÂº 140/2018, Anexos VI e VII.">CNAE</span> Principal
        <span class="req">*</span>
      </label>
      <select id="cnae">
        <option value="">Selecione o CNAE...</option>
        <optgroup label="ğŸ”„ Dependentes do Fator 'r' (Anexo III ou V)">
          <option value="71.19-7">71.19-7 â€” Atividades tÃ©cnicas de engenharia</option>
          <option value="62.01-5">62.01-5 â€” Desenvolvimento de software sob encomenda</option>
          <option value="62.02-3">62.02-3 â€” Licenciamento de software customizÃ¡vel</option>
          <option value="69.20-6">69.20-6 â€” Contabilidade, consultoria e auditoria</option>
          <option value="70.20-4">70.20-4 â€” Consultoria em gestÃ£o empresarial</option>
          <option value="73.11-4">73.11-4 â€” AgÃªncias de publicidade</option>
          <option value="86.30-5">86.30-5 â€” Atividade mÃ©dica ambulatorial</option>
          <option value="63.11-9">63.11-9 â€” Hospedagem e data centers</option>
          <option value="74.90-1">74.90-1 â€” ServiÃ§os tÃ©cnicos diversos</option>
        </optgroup>
        <optgroup label="ğŸ›’ ComÃ©rcio (Anexo I â€” Fixo)">
          <option value="47.11-3">47.11-3 â€” ComÃ©rcio varejista geral (supermercados)</option>
          <option value="47.51-2">47.51-2 â€” InformÃ¡tica e suprimentos</option>
          <option value="47.81-4">47.81-4 â€” VestuÃ¡rio e acessÃ³rios</option>
        </optgroup>
        <optgroup label="ğŸ­ IndÃºstria (Anexo II â€” Fixo)">
          <option value="10.91-1">10.91-1 â€” Produtos de panificaÃ§Ã£o</option>
          <option value="10.99-6">10.99-6 â€” Produtos alimentÃ­cios diversos</option>
        </optgroup>
        <optgroup label="ğŸ”§ ServiÃ§os Anexo IV (sem CPP no DAS)">
          <option value="81.21-4">81.21-4 â€” Limpeza em prÃ©dios e domicÃ­lios</option>
          <option value="80.11-1">80.11-1 â€” VigilÃ¢ncia e seguranÃ§a privada</option>
          <option value="41.20-4">41.20-4 â€” ConstruÃ§Ã£o de edifÃ­cios</option>
          <option value="69.11-7">69.11-7 â€” Advocacia</option>
        </optgroup>
        <optgroup label="ğŸ“‹ ServiÃ§os Anexo III (Fixo)">
          <option value="66.12-6">66.12-6 â€” Corretagem de valores</option>
        </optgroup>
      </select>
      <span class="hint">Determina o Anexo de tributaÃ§Ã£o. <em>Res. CGSN 140/2018, Anexos VI e VII</em></span>
    </div>
    <div class="form-group">
      <label><span class="sigla" data-tip="Unidade Federativa â€” estado brasileiro onde a empresa estÃ¡ registrada. Afeta ICMS, ISS e elegibilidade a incentivos regionais como SUDAM e SUDENE.">UF</span> <span class="req">*</span></label>
      <select id="uf">
        <option value="">Selecione...</option>
        <option value="AC">AC â€” Acre</option><option value="AL">AL â€” Alagoas</option>
        <option value="AM">AM â€” Amazonas</option><option value="AP">AP â€” AmapÃ¡</option>
        <option value="BA">BA â€” Bahia</option><option value="CE">CE â€” CearÃ¡</option>
        <option value="DF">DF â€” Distrito Federal</option><option value="ES">ES â€” EspÃ­rito Santo</option>
        <option value="GO">GO â€” GoiÃ¡s</option><option value="MA">MA â€” MaranhÃ£o</option>
        <option value="MG">MG â€” Minas Gerais</option><option value="MS">MS â€” Mato Grosso do Sul</option>
        <option value="MT">MT â€” Mato Grosso</option><option value="PA" selected>PA â€” ParÃ¡</option>
        <option value="PB">PB â€” ParaÃ­ba</option><option value="PE">PE â€” Pernambuco</option>
        <option value="PI">PI â€” PiauÃ­</option><option value="PR">PR â€” ParanÃ¡</option>
        <option value="RJ">RJ â€” Rio de Janeiro</option><option value="RN">RN â€” Rio Grande do Norte</option>
        <option value="RO">RO â€” RondÃ´nia</option><option value="RR">RR â€” Roraima</option>
        <option value="RS">RS â€” Rio Grande do Sul</option><option value="SC">SC â€” Santa Catarina</option>
        <option value="SE">SE â€” Sergipe</option><option value="SP">SP â€” SÃ£o Paulo</option>
        <option value="TO">TO â€” Tocantins</option>
      </select>
    </div>
    <div class="form-group">
      <label>MunicÃ­pio</label>
      <input type="text" id="municipio" placeholder="Ex.: Novo Progresso">
    </div>
  </div>

  <div class="form-row col-3">
    <div class="form-group">
      <label>
        AlÃ­quota do <span class="sigla" data-tip="Imposto Sobre ServiÃ§os de Qualquer Natureza â€” tributo municipal incidente sobre prestaÃ§Ã£o de serviÃ§os. AlÃ­quota varia de 2% a 5% conforme o municÃ­pio. Base: LC 116/2003.">ISS</span> Municipal (%)
      </label>
      <input type="number" id="aliquotaISS" value="5" min="2" max="5" step="0.5">
      <span class="hint">De 2% a 5% â€” conforme legislaÃ§Ã£o municipal. <em>LC 116/2003, Art. 8-A</em></span>
    </div>
    <div class="form-group">
      <label>Tipo de Atividade Principal</label>
      <select id="tipoAtividade">
        <option value="servicos">PrestaÃ§Ã£o de ServiÃ§os</option>
        <option value="comercio">ComÃ©rcio</option>
        <option value="industria">IndÃºstria</option>
        <option value="transporte">Transporte de Cargas</option>
      </select>
    </div>
    <div class="form-group">
      <label>Natureza JurÃ­dica</label>
      <select id="naturezaJuridica">
        <option value="ltda">Sociedade Limitada (Ltda)</option>
        <option value="slu">Sociedade Limitada Unipessoal (SLU)</option>
        <option value="eireli">EIRELI</option>
        <option value="ei">EmpresÃ¡rio Individual</option>
      </select>
    </div>
  </div>

  <div class="section-title">VerificaÃ§Ã£o de Elegibilidade <span class="st-sub">LC 123/2006, Arts. 3Âº e 17</span></div>

  <div class="info-card info">
    <span class="ic-icon">â„¹ï¸</span>
    <div>
      <div class="ic-title">VedaÃ§Ãµes ao Simples Nacional</div>
      Marque abaixo se alguma situaÃ§Ã£o se aplica Ã  empresa. Qualquer item marcado <strong>impede</strong> a opÃ§Ã£o ou permanÃªncia no Simples Nacional.
      <div class="ic-ref">Base legal: LC 123/2006, Art. 3Âº, Â§4Âº e Art. 17</div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px 20px;margin:12px 0">
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedSocioPJ" style="margin-top:3px">
      <span>Possui sÃ³cio que Ã© pessoa jurÃ­dica <span style="color:var(--txt3);font-size:11px">(Art. 3Âº, Â§4Âº, I)</span></span>
    </label>
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedSocioOutraPJ" style="margin-top:3px">
      <span>SÃ³cio com &gt;10% em outra PJ (receita global &gt;R$ 4,8M) <span style="color:var(--txt3);font-size:11px">(Art. 3Âº, Â§4Âº, IV)</span></span>
    </label>
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedDebitos" style="margin-top:3px">
      <span>DÃ©bitos fiscais pendentes sem exigibilidade suspensa <span style="color:var(--txt3);font-size:11px">(Art. 17, V)</span></span>
    </label>
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedSocioExterior" style="margin-top:3px">
      <span>SÃ³cio domiciliado no exterior <span style="color:var(--txt3);font-size:11px">(Art. 3Âº, Â§4Âº, VIII)</span></span>
    </label>
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedCessaoMO" style="margin-top:3px">
      <span>CessÃ£o/locaÃ§Ã£o de mÃ£o de obra (exceto Anexo IV) <span style="color:var(--txt3);font-size:11px">(Art. 17, XII)</span></span>
    </label>
    <label style="display:flex;gap:8px;align-items:flex-start;font-size:13px;cursor:pointer">
      <input type="checkbox" id="vedFilialExterior" style="margin-top:3px">
      <span>Filial, sucursal ou representaÃ§Ã£o no exterior <span style="color:var(--txt3);font-size:11px">(Art. 3Âº, Â§4Âº, VII)</span></span>
    </label>
  </div>

  <div id="vedacaoAlerta" class="info-card danger hidden">
    <span class="ic-icon">ğŸš«</span>
    <div>
      <div class="ic-title">Impedimento Detectado!</div>
      <span id="vedacaoMsg">Uma ou mais vedaÃ§Ãµes se aplicam. A empresa nÃ£o pode optar pelo Simples Nacional.</span>
      <div class="ic-ref">LC 123/2006, Art. 3Âº, Â§4Âº e Art. 17</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 2: RECEITAS E FATURAMENTO â•â•â•â•â•â•â• -->
<div class="step-panel" id="step2">
  <div class="step-header">
    <div class="step-icon">ğŸ’°</div>
    <div class="step-header-text">
      <h2>Etapa 2 de 7 â€” Receitas e Faturamento</h2>
      <p>Dados de receita bruta para cÃ¡lculo do <span class="sigla" data-tip="Receita Bruta acumulada nos Ãºltimos 12 meses â€” Ã© a base para determinar a faixa de tributaÃ§Ã£o e a alÃ­quota efetiva no Simples Nacional. Base: LC 123/2006, Art. 18, Â§1Âº.">RBT12</span> e enquadramento na faixa</p>
    </div>
  </div>

  <div class="section-title">Receita Bruta <span class="st-sub">LC 123/2006, Art. 3Âº</span></div>

  <div class="form-row">
    <div class="form-group">
      <label>
        Receita Bruta Mensal (mÃ©dia)
        <span class="req">*</span>
        <span class="tooltip-icon" data-tip="Receita bruta = totalidade das vendas/serviÃ§os, sem deduÃ§Ãµes. Inclui todos os CNAEs da empresa.">?</span>
      </label>
      <input type="text" id="receitaMensal" class="money-input" placeholder="R$ 0,00" value="">
      <span class="hint">Receita mÃ©dia mensal dos Ãºltimos 12 meses</span>
    </div>
    <div class="form-group">
      <label>
        <span class="sigla" data-tip="Receita Bruta acumulada nos Ãºltimos 12 meses â€” base de cÃ¡lculo para determinar a faixa de tributaÃ§Ã£o no Simples Nacional. Calculada automaticamente: receita mensal Ã— 12.">RBT12</span>
        (calculado automaticamente)
      </label>
      <input type="text" id="rbt12" class="money-input" readonly style="background:#f7faf7">
      <span class="hint">Receita mensal Ã— 12. Limite: R$ 4.800.000,00 <em>(LC 123/2006, Art. 3Âº, II)</em></span>
    </div>
  </div>

  <div id="classificacaoBox" class="info-card info">
    <span class="ic-icon">ğŸ“‹</span>
    <div>
      <div class="ic-title">ClassificaÃ§Ã£o: <span id="classificacaoLabel">â€”</span></div>
      <span id="classificacaoDesc">Informe a receita mensal para classificar a empresa.</span>
      <div class="ic-ref" id="classificacaoRef">LC 123/2006, Art. 3Âº, I e II</div>
    </div>
  </div>

  <div class="section-title">Regime de Reconhecimento <span class="st-sub">LC 123/2006, Art. 18, Â§3Âº</span></div>

  <div class="toggle-wrap">
    <div class="toggle" id="toggleRegimeCaixa" onclick="this.classList.toggle('on')"></div>
    <div>
      <span class="toggle-label">Optar pelo Regime de Caixa</span>
      <span class="toggle-sub">Reconhecer receitas apenas quando efetivamente recebidas. OpÃ§Ã£o irretratÃ¡vel para o ano-calendÃ¡rio. <em>(LC 123/2006, Art. 18, Â§3Âº)</em></span>
    </div>
  </div>

  <div class="section-title">Receita do Ano Anterior <span class="st-sub">Para verificaÃ§Ã£o de limites</span></div>
  <div class="form-row col-3">
    <div class="form-group">
      <label>Receita Bruta do Ano Anterior</label>
      <input type="text" id="receitaAnterior" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Para verificaÃ§Ã£o de exclusÃ£o. <em>(LC 123/2006, Art. 3Âº, II)</em></span>
    </div>
    <div class="form-group">
      <label>Meses de Atividade (se inÃ­cio recente)</label>
      <input type="number" id="mesesAtividade" value="12" min="1" max="12">
      <span class="hint">Para cÃ¡lculo proporcional do RBT12</span>
    </div>
    <div class="form-group">
      <label>Despesas Operacionais Anuais</label>
      <input type="text" id="despesasOperacionais" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Custos, despesas administrativas, aluguel, etc. (para comparativo com Lucro Real)</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 3: FOLHA E FATOR "r" â•â•â•â•â•â•â• -->
<div class="step-panel" id="step3">
  <div class="step-header">
    <div class="step-icon">ğŸ‘¥</div>
    <div class="step-header-text">
      <h2>Etapa 3 de 7 â€” Folha de Pagamento e Fator "r"</h2>
      <p>O <span class="sigla" data-tip="Fator 'r' = Folha de SalÃ¡rios dos Ãºltimos 12 meses Ã· Receita Bruta dos Ãºltimos 12 meses. Se â‰¥ 28%, empresa tributa pelo Anexo III (alÃ­quotas menores). Se < 28%, Anexo V (alÃ­quotas maiores). Base: ResoluÃ§Ã£o CGSN nÂº 140/2018, Art. 18, Â§5Âº-J.">Fator "r"</span> determina se a empresa paga pelo Anexo III ou V</p>
    </div>
  </div>

  <div class="section-title">ComposiÃ§Ã£o da Folha <span class="st-sub">ResoluÃ§Ã£o CGSN 140/2018, Art. 18, Â§5Âº-M</span></div>

  <div class="info-card info">
    <span class="ic-icon">ğŸ“Œ</span>
    <div>
      <div class="ic-title">O que conta como "Folha de SalÃ¡rios" para o Fator "r"?</div>
      SalÃ¡rios, prÃ³-labore, <span class="sigla" data-tip="Fundo de Garantia do Tempo de ServiÃ§o â€” contribuiÃ§Ã£o mensal de 8% sobre a remuneraÃ§Ã£o do empregado, depositada em conta vinculada. Base: Lei 8.036/1990, Art. 15.">FGTS</span>, contribuiÃ§Ã£o previdenciÃ¡ria patronal incidente sobre folha, e 13Âº salÃ¡rio.
      <strong>NÃ£o conta:</strong> distribuiÃ§Ã£o de lucros, aluguÃ©is, serviÃ§os de terceiros (PJ).
      <div class="ic-ref">ResoluÃ§Ã£o CGSN nÂº 140/2018, Art. 18, Â§5Âº-M; Art. 24</div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Folha de SalÃ¡rios Mensal (incluindo prÃ³-labore) <span class="req">*</span></label>
      <input type="text" id="folhaMensal" class="money-input" placeholder="R$ 0,00">
      <span class="hint">SalÃ¡rios brutos + prÃ³-labore + encargos sobre a folha</span>
    </div>
    <div class="form-group">
      <label>Folha Acumulada 12 Meses (calculado)</label>
      <input type="text" id="folha12" class="money-input" readonly style="background:#f7faf7">
      <span class="hint">Folha mensal Ã— 12</span>
    </div>
  </div>

  <div class="form-row col-3">
    <div class="form-group">
      <label>Quantidade de FuncionÃ¡rios</label>
      <input type="number" id="qtdFuncionarios" value="0" min="0">
    </div>
    <div class="form-group">
      <label>
        AlÃ­quota <span class="sigla" data-tip="Riscos Ambientais do Trabalho â€” contribuiÃ§Ã£o previdenciÃ¡ria adicional que varia de 1% a 3% conforme o grau de risco da atividade (CNAE). Para serviÃ§os, geralmente 2%.">RAT</span> (%)
      </label>
      <input type="number" id="aliquotaRAT" value="2" min="1" max="3" step="1">
      <span class="hint">1% a 3% conforme grau de risco do CNAE</span>
    </div>
    <div class="form-group">
      <label>Fator "r" (calculado)</label>
      <input type="text" id="fatorRDisplay" readonly style="background:#f7faf7;font-weight:700;font-size:18px;text-align:center">
    </div>
  </div>

  <div id="fatorRResult" class="info-card info">
    <span class="ic-icon">ğŸ“Š</span>
    <div>
      <div class="ic-title">Resultado do Fator "r": <span id="fatorRLabel">â€”</span></div>
      <span id="fatorRDesc">Informe receita e folha para calcular.</span>
      <div class="ic-ref">ResoluÃ§Ã£o CGSN nÂº 140/2018, Art. 18, Â§5Âº-J</div>
    </div>
  </div>

  <div id="fatorROtimizacao" class="info-card success hidden">
    <span class="ic-icon">ğŸ’¡</span>
    <div>
      <div class="ic-title">EstratÃ©gia: OtimizaÃ§Ã£o do Fator "r"</div>
      <span id="fatorROtimMsg"></span>
      <div class="ic-ref">LC 123/2006, Art. 18, Â§24; ResoluÃ§Ã£o CGSN 140/2018, Art. 18, Â§5Âº-J</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 4: DEDUÃ‡Ã•ES E SEGREGAÃ‡ÃƒO â•â•â•â•â•â•â• -->
<div class="step-panel" id="step4">
  <div class="step-header">
    <div class="step-icon">ğŸ“‰</div>
    <div class="step-header-text">
      <h2>Etapa 4 de 7 â€” DeduÃ§Ãµes Legais e SegregaÃ§Ã£o de Receitas</h2>
      <p>Reduza legalmente o <span class="sigla" data-tip="Documento de ArrecadaÃ§Ã£o do Simples Nacional â€” guia Ãºnica mensal que consolida atÃ© 8 tributos: IRPJ, CSLL, PIS, COFINS, CPP, ICMS, ISS e IPI.">DAS</span> segregando receitas corretamente no <span class="sigla" data-tip="Programa Gerador do Documento de ArrecadaÃ§Ã£o do Simples Nacional â€” DeclaratÃ³rio. Sistema online onde a empresa declara suas receitas mensalmente e gera a guia DAS. Base: ResoluÃ§Ã£o CGSN nÂº 140/2018, Art. 38.">PGDAS-D</span></p>
    </div>
  </div>

  <div class="info-card warn">
    <span class="ic-icon">âš ï¸</span>
    <div>
      <div class="ic-title">AtenÃ§Ã£o: SegregaÃ§Ã£o correta Ã© obrigatÃ³ria e gera economia!</div>
      A falta de segregaÃ§Ã£o correta pode resultar em pagamento <strong>a maior</strong> de tributos. Verifique mensalmente se todas as receitas estÃ£o classificadas corretamente no PGDAS-D.
      <div class="ic-ref">LC 123/2006, Art. 18, Â§Â§4Âº e 4Âº-A; ResoluÃ§Ã£o CGSN 140/2018, Art. 25</div>
    </div>
  </div>

  <div class="section-title">Receitas com TributaÃ§Ã£o Especial <span class="st-sub">Art. 18, Â§4Âº-A</span></div>

  <div class="form-row">
    <div class="form-group">
      <label>
        Receita com <span class="sigla" data-tip="TributaÃ§Ã£o MonofÃ¡sica (ou Concentrada) â€” PIS e COFINS jÃ¡ foram recolhidos na etapa de fabricaÃ§Ã£o/importaÃ§Ã£o. O revendedor exclui essas parcelas do DAS. Aplica-se a combustÃ­veis, bebidas, medicamentos, cosmÃ©ticos, entre outros.">PIS/COFINS MonofÃ¡sico</span> (mensal)
        <span class="tooltip-icon" data-tip="Produtos como combustÃ­veis, bebidas, medicamentos e cosmÃ©ticos. Exclui parcela PIS/COFINS do DAS. Base: Art. 18, Â§4Âº-A, I.">?</span>
      </label>
      <input type="text" id="receitaMonofasica" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Reduz DAS: exclui parcela PIS/COFINS. <em>Art. 18, Â§4Âº-A, I</em></span>
    </div>
    <div class="form-group">
      <label>
        Receita com <span class="sigla" data-tip="Imposto sobre CirculaÃ§Ã£o de Mercadorias e ServiÃ§os com SubstituiÃ§Ã£o TributÃ¡ria â€” o ICMS jÃ¡ foi recolhido pelo fabricante/importador. O revendedor exclui a parcela ICMS do DAS.">ICMS-ST</span> (mensal)
        <span class="tooltip-icon" data-tip="Mercadorias cuja ICMS jÃ¡ foi recolhida por substituiÃ§Ã£o tributÃ¡ria. Exclui parcela ICMS do DAS. Base: Art. 18, Â§4Âº-A, I.">?</span>
      </label>
      <input type="text" id="receitaICMS_ST" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Reduz DAS: exclui parcela ICMS. <em>Art. 18, Â§4Âº-A, I</em></span>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>
        Receita de ExportaÃ§Ã£o (mensal)
        <span class="tooltip-icon" data-tip="Receitas de exportaÃ§Ã£o de mercadorias ou serviÃ§os sÃ£o ISENTAS de COFINS, PIS, IPI, ICMS e ISS dentro do DAS. Economia significativa. Base: Art. 18, Â§14 e Â§4Âº-A, IV.">?</span>
      </label>
      <input type="text" id="receitaExportacao" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Reduz DAS significativamente: exclui COFINS, PIS, IPI, ICMS, ISS. <em>Art. 18, Â§4Âº-A, IV</em></span>
    </div>
    <div class="form-group">
      <label>
        Receita de LocaÃ§Ã£o de Bens MÃ³veis (mensal)
        <span class="tooltip-icon" data-tip="LocaÃ§Ã£o de bens mÃ³veis NÃƒO Ã© prestaÃ§Ã£o de serviÃ§o para fins de ISS. A parcela do ISS Ã© deduzida do DAS. Base: LC 123/2006, Art. 18, Â§4Âº, V.">?</span>
      </label>
      <input type="text" id="receitaLocacao" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Reduz DAS: deduz parcela ISS. <em>Art. 18, Â§4Âº, V</em></span>
    </div>
  </div>

  <div class="form-row col-1">
    <div class="form-group">
      <label>
        <span class="sigla" data-tip="Imposto Sobre ServiÃ§os â€” quando o tomador do serviÃ§o retÃ©m o ISS na fonte (retenÃ§Ã£o na fonte), esse valor deve ser deduzido do DAS para evitar bitributaÃ§Ã£o.">ISS</span> Retido na Fonte (mensal)
        <span class="tooltip-icon" data-tip="Valor de ISS jÃ¡ retido pelo tomador do serviÃ§o. Deve ser abatido do DAS. Base: Art. 18, Â§4Âº-A, II; Art. 21, Â§4Âº.">?</span>
      </label>
      <input type="text" id="issRetidoFonte" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Reduz DAS: deduz valor do ISS retido. <em>Res. CGSN 140/2018, Art. 27</em></span>
    </div>
  </div>

  <div class="section-title">Produtos com TributaÃ§Ã£o MonofÃ¡sica â€” ReferÃªncia <span class="st-sub">Art. 13, Â§1Âº, XIII</span></div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      ğŸ“¦ Ver lista de categorias com tributaÃ§Ã£o monofÃ¡sica
      <span class="arrow">â–¼</span>
    </div>
    <div class="accordion-body" id="monoList">
      <!-- Populated by JS -->
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 5: SÃ“CIOS E DISTRIBUIÃ‡ÃƒO DE LUCROS â•â•â•â•â•â•â• -->
<div class="step-panel" id="step5">
  <div class="step-header">
    <div class="step-icon">ğŸ¤</div>
    <div class="step-header-text">
      <h2>Etapa 5 de 7 â€” SÃ³cios e DistribuiÃ§Ã£o de Lucros</h2>
      <p>Configurar sÃ³cios e calcular lucros distribuÃ­veis com isenÃ§Ã£o de <span class="sigla" data-tip="Imposto de Renda Pessoa FÃ­sica â€” incide sobre a renda dos sÃ³cios. Lucros distribuÃ­dos dentro do limite da presunÃ§Ã£o (ou do lucro contÃ¡bil) sÃ£o ISENTOS de IRPF.">IRPF</span></p>
    </div>
  </div>

  <div class="section-title">Quadro SocietÃ¡rio <span class="st-sub">LC 123/2006, Art. 14</span></div>

  <div id="sociosContainer">
    <div class="socio-row">
      <div class="form-group">
        <label>Nome do SÃ³cio</label>
        <input type="text" class="socio-nome" placeholder="Nome do sÃ³cio" value="SÃ³cio 1">
      </div>
      <div class="form-group">
        <label>ParticipaÃ§Ã£o %</label>
        <input type="number" class="socio-perc" value="65" min="0" max="100">
      </div>
      <div class="form-group">
        <label>PrÃ³-labore</label>
        <input type="text" class="socio-prolabore money-input" placeholder="R$ 0,00">
      </div>
      <button class="btn-remove" onclick="removeSocio(this)" title="Remover sÃ³cio">Ã—</button>
    </div>
    <div class="socio-row">
      <div class="form-group">
        <label>Nome do SÃ³cio</label>
        <input type="text" class="socio-nome" placeholder="Nome do sÃ³cio" value="SÃ³cio 2">
      </div>
      <div class="form-group">
        <label>ParticipaÃ§Ã£o %</label>
        <input type="number" class="socio-perc" value="35" min="0" max="100">
      </div>
      <div class="form-group">
        <label>PrÃ³-labore</label>
        <input type="text" class="socio-prolabore money-input" placeholder="R$ 0,00">
      </div>
      <button class="btn-remove" onclick="removeSocio(this)" title="Remover sÃ³cio">Ã—</button>
    </div>
  </div>
  <button class="btn btn-secondary btn-sm mt-8" onclick="addSocio()">+ Adicionar SÃ³cio</button>

  <div class="section-title">DistribuiÃ§Ã£o de Lucros <span class="st-sub">LC 123/2006, Art. 14; RIR/2018, Art. 145</span></div>

  <div class="toggle-wrap mt-16">
    <div class="toggle" id="toggleEscrituracao" onclick="this.classList.toggle('on')"></div>
    <div>
      <span class="toggle-label">EscrituraÃ§Ã£o contÃ¡bil completa</span>
      <span class="toggle-sub">Permite distribuir lucros acima da presunÃ§Ã£o (32% para serviÃ§os) com isenÃ§Ã£o de IRPF. Recomendado para maximizar distribuiÃ§Ã£o. <em>(LC 123/2006, Art. 14)</em></span>
    </div>
  </div>

  <div class="form-row" id="lucroContabilRow" style="display:none">
    <div class="form-group">
      <label>Lucro ContÃ¡bil Efetivo (anual)</label>
      <input type="text" id="lucroContabil" class="money-input" placeholder="R$ 0,00">
      <span class="hint">Se maior que a presunÃ§Ã£o, permite distribuiÃ§Ã£o isenta maior</span>
    </div>
  </div>

  <div class="info-card info">
    <span class="ic-icon">ğŸ’¡</span>
    <div>
      <div class="ic-title">Como funciona a distribuiÃ§Ã£o de lucros no Simples?</div>
      <strong>Sem escrituraÃ§Ã£o:</strong> Lucro isento = (Receita Ã— Percentual de PresunÃ§Ã£o) âˆ’ DAS pago. PresunÃ§Ã£o: 8% comÃ©rcio, 16% transporte, 32% serviÃ§os.<br>
      <strong>Com escrituraÃ§Ã£o:</strong> Lucro isento = Lucro ContÃ¡bil âˆ’ DAS pago. Usa-se o <strong>maior</strong> entre presunÃ§Ã£o e lucro contÃ¡bil.
      <div class="ic-ref">LC 123/2006, Art. 14; RIR/2018, Art. 145</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 6: CENÃRIOS E COMPARATIVO â•â•â•â•â•â•â• -->
<div class="step-panel" id="step6">
  <div class="step-header">
    <div class="step-icon">âš–ï¸</div>
    <div class="step-header-text">
      <h2>Etapa 6 de 7 â€” CenÃ¡rios e Comparativo de Regimes</h2>
      <p>Simule cenÃ¡rios e compare com Lucro Presumido e Lucro Real</p>
    </div>
  </div>

  <div class="section-title">ConfiguraÃ§Ã£o de CenÃ¡rios <span class="st-sub">SimulaÃ§Ã£o "E se?"</span></div>

  <div class="toggle-wrap">
    <div class="toggle" id="toggleSUDAM" onclick="this.classList.toggle('on')"></div>
    <div>
      <span class="toggle-label">Empresa localizada em Ã¡rea <span class="sigla" data-tip="SuperintendÃªncia do Desenvolvimento da AmazÃ´nia â€” autarquia federal que administra incentivos fiscais na AmazÃ´nia Legal. Empresas com projeto aprovado podem obter reduÃ§Ã£o de 75% do IRPJ no Lucro Real. Base: Lei 12.715/2012; Decreto 4.212/2002.">SUDAM</span> / <span class="sigla" data-tip="SuperintendÃªncia do Desenvolvimento do Nordeste â€” autarquia federal que administra incentivos fiscais no Nordeste. ReduÃ§Ã£o de 75% do IRPJ para projetos aprovados.">SUDENE</span></span>
      <span class="toggle-sub">Se sim, o comparativo incluirÃ¡ Lucro Real com reduÃ§Ã£o de 75% do IRPJ. <strong>NÃ£o disponÃ­vel no Simples Nacional.</strong></span>
    </div>
  </div>

  <div class="toggle-wrap">
    <div class="toggle" id="toggleVendeB2B" onclick="this.classList.toggle('on')"></div>
    <div>
      <span class="toggle-label">Vende predominantemente para empresas (B2B)</span>
      <span class="toggle-sub">Impacta na anÃ¡lise: clientes Lucro Real nÃ£o tomam crÃ©ditos PIS/COFINS de fornecedores do Simples.</span>
    </div>
  </div>

  <div class="toggle-wrap">
    <div class="toggle" id="toggleExporta" onclick="this.classList.toggle('on')"></div>
    <div>
      <span class="toggle-label">Empresa exporta mercadorias ou serviÃ§os</span>
      <span class="toggle-sub">ExportaÃ§Ãµes sÃ£o isentas de COFINS, PIS, IPI, ICMS e ISS no DAS. <em>(Art. 18, Â§14)</em></span>
    </div>
  </div>

  <div style="text-align:center;margin:24px 0">
    <button class="btn btn-primary" onclick="calcularTudo()" style="padding:14px 40px;font-size:16px">
      ğŸ“Š Calcular Estudo Completo
    </button>
  </div>

  <div id="resultadoComparativo"></div>
</div>

<!-- â•â•â•â•â•â•â• ETAPA 7: RELATÃ“RIO FINAL â•â•â•â•â•â•â• -->
<div class="step-panel" id="step7">
  <div class="step-header">
    <div class="step-icon">ğŸ“‹</div>
    <div class="step-header-text">
      <h2>Etapa 7 de 7 â€” RelatÃ³rio Final</h2>
      <p>RevisÃ£o, estratÃ©gias, riscos e plano de aÃ§Ã£o</p>
    </div>
  </div>

  <div id="relatorioFinal">
    <div class="info-card info">
      <span class="ic-icon">ğŸ“Š</span>
      <div>Clique em <strong>"Calcular Estudo Completo"</strong> na etapa anterior para gerar o relatÃ³rio.</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• NAVIGATION BUTTONS â•â•â•â•â•â•â• -->
<div class="btn-row">
  <button class="btn btn-secondary" id="btnPrev" onclick="prevStep()" disabled>â† Anterior</button>
  <span style="font-size:13px;color:var(--txt3)" id="stepIndicator">Etapa 1 de 7</span>
  <button class="btn btn-primary" id="btnNext" onclick="nextStep()">PrÃ³xima â†’</button>
</div>

</div><!-- .wizard-card -->
</div><!-- .container -->

<footer class="site-footer">
  <strong>IMPOST.</strong> â€” InteligÃªncia em Modelagem de OtimizaÃ§Ã£o TributÃ¡ria v4.1<br>
  Base Legal: LC 123/2006 â€¢ LC 155/2016 â€¢ LC 147/2014 â€¢ ResoluÃ§Ã£o CGSN nÂº 140/2018<br>
  Este estudo tem carÃ¡ter informativo e nÃ£o substitui orientaÃ§Ã£o contÃ¡bil profissional.
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCRIPTS                                              -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="../scripts/simples_nacional.js"></script>
<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHIM: Importar funÃ§Ãµes e constantes do IMPOST
// (simples_nacional.js exporta via globalThis.IMPOST)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _SN = (typeof IMPOST !== 'undefined') ? IMPOST : (typeof SimplesNacional !== 'undefined') ? SimplesNacional : {};

// FunÃ§Ãµes
const calcularFatorR = _SN.calcularFatorR || function(){};
const determinarAnexo = _SN.determinarAnexo || function(){};
const calcularAliquotaEfetiva = _SN.calcularAliquotaEfetiva || function(){};
const calcularDASMensal = _SN.calcularDASMensal || function(){};
const calcularDASMensalOtimizado = _SN.calcularDASMensalOtimizado || function(){};
const calcularAnualConsolidado = _SN.calcularAnualConsolidado || function(){};
const calcularDistribuicaoLucros = _SN.calcularDistribuicaoLucros || function(){};
const compararRegimesCompleto = _SN.compararRegimesCompleto || function(){};
const analisarVantagensDesvantagens = _SN.analisarVantagensDesvantagens || function(){};
const verificarElegibilidade = _SN.verificarElegibilidade || function(){};

// Constantes / Tabelas
const ESTRATEGIAS_MENOR_IMPOSTO = _SN.ESTRATEGIAS_MENOR_IMPOSTO || [];
const RISCOS_FISCAIS = _SN.RISCOS_FISCAIS || [];
const OBRIGACOES_ACESSORIAS = _SN.OBRIGACOES_ACESSORIAS || [];
const PRODUTOS_MONOFASICOS = _SN.PRODUTOS_MONOFASICOS || [];
const TRANSICOES = _SN.TRANSICOES || {};
const ANEXOS = _SN.ANEXOS || {};
const PARTILHA = _SN.PARTILHA || {};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIZARD NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentStep = 1;
const totalSteps = 7;

function goToStep(n) {
  if (n < 1 || n > totalSteps) return;
  document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('step' + n).classList.add('active');
  document.querySelectorAll('.progress-step').forEach((s, i) => {
    s.classList.remove('active', 'done');
    if (i + 1 < n) s.classList.add('done');
    else if (i + 1 === n) s.classList.add('active');
  });
  document.getElementById('progressFill').style.width = ((n - 1) / (totalSteps - 1) * 100) + '%';
  document.getElementById('btnPrev').disabled = n === 1;
  document.getElementById('btnNext').textContent = n === totalSteps ? 'ğŸ–¨ï¸ Imprimir' : 'PrÃ³xima â†’';
  document.getElementById('stepIndicator').textContent = `Etapa ${n} de ${totalSteps}`;
  currentStep = n;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function nextStep() {
  if (currentStep === totalSteps) { window.print(); return; }
  goToStep(currentStep + 1);
}
function prevStep() { goToStep(currentStep - 1); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMATAÃ‡ÃƒO DE MOEDA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtBRL(v) {
  if (v === null || v === undefined || isNaN(v)) return 'R$ 0,00';
  const parts = Math.abs(v).toFixed(2).split('.');
  const intPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  return `${v < 0 ? '-' : ''}R$ ${intPart},${parts[1]}`;
}

function parseMoney(str) {
  if (!str) return 0;
  return parseFloat(str.replace(/[^\d,.-]/g, '').replace(/\./g, '').replace(',', '.')) || 0;
}

function applyMoneyMask(input) {
  input.addEventListener('blur', function () {
    const val = parseMoney(this.value);
    if (val > 0) this.value = fmtBRL(val);
  });
  input.addEventListener('focus', function () {
    const val = parseMoney(this.value);
    if (val > 0) this.value = val.toString().replace('.', ',');
  });
}

document.querySelectorAll('.money-input').forEach(applyMoneyMask);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-CÃLCULOS REATIVOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const $id = id => document.getElementById(id);

function recalcular() {
  const receitaMensal = parseMoney($id('receitaMensal').value);
  const rbt12 = receitaMensal * 12;
  $id('rbt12').value = rbt12 > 0 ? fmtBRL(rbt12) : '';

  // ClassificaÃ§Ã£o
  const clBox = $id('classificacaoBox');
  const clLabel = $id('classificacaoLabel');
  const clDesc = $id('classificacaoDesc');
  if (rbt12 <= 0) {
    clLabel.textContent = 'â€”';
    clDesc.textContent = 'Informe a receita mensal para classificar a empresa.';
    clBox.className = 'info-card info';
  } else if (rbt12 <= 360000) {
    clLabel.textContent = 'ME â€” Microempresa';
    clDesc.textContent = `RBT12 de ${fmtBRL(rbt12)} estÃ¡ dentro do limite ME (atÃ© R$ 360.000,00).`;
    clBox.className = 'info-card success';
  } else if (rbt12 <= 4800000) {
    clLabel.textContent = 'EPP â€” Empresa de Pequeno Porte';
    clDesc.textContent = `RBT12 de ${fmtBRL(rbt12)} estÃ¡ dentro do limite EPP (atÃ© R$ 4.800.000,00).`;
    clBox.className = 'info-card info';
    if (rbt12 > 3600000) {
      clDesc.textContent += ' âš ï¸ Acima do sublimite de R$ 3.600.000: ICMS e ISS serÃ£o recolhidos por fora do DAS.';
      clBox.className = 'info-card warn';
    }
  } else {
    clLabel.textContent = 'ğŸš« EXCEDE LIMITE';
    clDesc.textContent = `RBT12 de ${fmtBRL(rbt12)} excede o limite do Simples Nacional (R$ 4.800.000,00).`;
    clBox.className = 'info-card danger';
  }

  // Folha e Fator R
  const folhaMensal = parseMoney($id('folhaMensal').value);
  const folha12 = folhaMensal * 12;
  $id('folha12').value = folha12 > 0 ? fmtBRL(folha12) : '';

  if (rbt12 > 0 && folha12 >= 0) {
    const fatorR = folha12 / rbt12;
    $id('fatorRDisplay').value = (fatorR * 100).toFixed(2).replace('.', ',') + '%';

    const frLabel = $id('fatorRLabel');
    const frDesc = $id('fatorRDesc');
    const frResult = $id('fatorRResult');
    const frOtim = $id('fatorROtimizacao');

    if (fatorR >= 0.28) {
      frLabel.textContent = `${(fatorR * 100).toFixed(2)}% â†’ Anexo III âœ…`;
      frDesc.textContent = `Fator "r" acima do limiar de 28%. TributaÃ§Ã£o pelo Anexo III (alÃ­quotas menores).`;
      frResult.className = 'info-card success';
      $id('fatorRDisplay').style.color = 'var(--ok)';

      if (fatorR <= 0.31) {
        frOtim.classList.remove('hidden');
        $id('fatorROtimMsg').innerHTML = `<strong>AtenÃ§Ã£o:</strong> Fator "r" entre 28% e 31% â€” zona de flutuaÃ§Ã£o. Pequenas variaÃ§Ãµes na folha ou receita podem alterar o anexo. Monitore mensalmente.`;
        frOtim.className = 'info-card warn';
      } else {
        frOtim.classList.add('hidden');
      }
    } else {
      frLabel.textContent = `${(fatorR * 100).toFixed(2)}% â†’ Anexo V âŒ`;
      frDesc.textContent = `Fator "r" abaixo de 28%. TributaÃ§Ã£o pelo Anexo V (alÃ­quotas maiores). Considere aumentar a folha.`;
      frResult.className = 'info-card danger';
      $id('fatorRDisplay').style.color = 'var(--danger)';

      // Mostrar otimizaÃ§Ã£o
      const folhaNecessaria = rbt12 * 0.28;
      const aumentoMensal = (folhaNecessaria - folha12) / 12;
      if (aumentoMensal > 0) {
        frOtim.classList.remove('hidden');
        frOtim.className = 'info-card success';
        $id('fatorROtimMsg').innerHTML = `Para atingir o Anexo III, a folha mensal precisa aumentar <strong>${fmtBRL(aumentoMensal)}</strong> (folha total de 12 meses: ${fmtBRL(folhaNecessaria)}). Avalie ajustar o prÃ³-labore dos sÃ³cios.`;
      }
    }
  }
}

// Listeners
['receitaMensal', 'folhaMensal'].forEach(id => {
  $id(id).addEventListener('input', recalcular);
  $id(id).addEventListener('blur', recalcular);
});

// VedaÃ§Ãµes
document.querySelectorAll('[id^="ved"]').forEach(el => {
  if (el.type === 'checkbox') {
    el.addEventListener('change', () => {
      const anyChecked = [...document.querySelectorAll('[id^="ved"]')].some(c => c.type === 'checkbox' && c.checked);
      $id('vedacaoAlerta').classList.toggle('hidden', !anyChecked);
    });
  }
});

// Toggle escrituraÃ§Ã£o contÃ¡bil
$id('toggleEscrituracao').addEventListener('click', function () {
  $id('lucroContabilRow').style.display = this.classList.contains('on') ? 'grid' : 'none';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCORDION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAccordion(header) {
  header.classList.toggle('open');
  const body = header.nextElementSibling;
  body.classList.toggle('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SÃ“CIOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addSocio() {
  const container = $id('sociosContainer');
  const row = document.createElement('div');
  row.className = 'socio-row';
  const num = container.children.length + 1;
  row.innerHTML = `
    <div class="form-group"><label>Nome do SÃ³cio</label><input type="text" class="socio-nome" placeholder="Nome" value="SÃ³cio ${num}"></div>
    <div class="form-group"><label>ParticipaÃ§Ã£o %</label><input type="number" class="socio-perc" value="0" min="0" max="100"></div>
    <div class="form-group"><label>PrÃ³-labore</label><input type="text" class="socio-prolabore money-input" placeholder="R$ 0,00"></div>
    <button class="btn-remove" onclick="removeSocio(this)" title="Remover">Ã—</button>`;
  container.appendChild(row);
  row.querySelectorAll('.money-input').forEach(applyMoneyMask);
}

function removeSocio(btn) {
  const container = $id('sociosContainer');
  if (container.children.length > 1) btn.parentElement.remove();
}

function getSocios() {
  return [...$id('sociosContainer').children].map(row => ({
    nome: row.querySelector('.socio-nome')?.value || 'SÃ³cio',
    percentual: (parseFloat(row.querySelector('.socio-perc')?.value) || 0) / 100
  }));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULO PRINCIPAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcularTudo() {
  const receitaMensal = parseMoney($id('receitaMensal').value);
  const rbt12 = receitaMensal * 12;
  const folhaMensal = parseMoney($id('folhaMensal').value);
  const folha12 = folhaMensal * 12;
  const cnae = $id('cnae').value;
  const uf = $id('uf').value;
  const municipio = $id('municipio').value;
  const aliquotaISS = parseFloat($id('aliquotaISS').value) / 100;
  const aliquotaRAT = parseFloat($id('aliquotaRAT').value) / 100;
  const despesas = parseMoney($id('despesasOperacionais').value) || (rbt12 * 0.3);
  const socios = getSocios();
  const temSUDAM = $id('toggleSUDAM').classList.contains('on');
  const vendeB2B = $id('toggleVendeB2B').classList.contains('on');
  const exporta = $id('toggleExporta').classList.contains('on');

  if (rbt12 <= 0) { alert('Informe a receita mensal na Etapa 2.'); goToStep(2); return; }
  if (!cnae) { alert('Selecione o CNAE na Etapa 1.'); goToStep(1); return; }

  try {
    // Fator R e Anexo
    const fatorR = rbt12 > 0 ? folha12 / rbt12 : 0;
    let anexo = 'III';
    try {
      const anexoResult = determinarAnexo({ cnae, fatorR });
      if (anexoResult.vedado) { alert('CNAE vedado ao Simples Nacional!'); return; }
      anexo = anexoResult.anexo;
    } catch (e) {
      anexo = fatorR >= 0.28 ? 'III' : 'V';
    }

    // AlÃ­quota efetiva
    const aliqResult = calcularAliquotaEfetiva({ rbt12, anexo });

    // DAS mensal
    const dasMensal = calcularDASMensal({
      receitaBrutaMensal: receitaMensal, rbt12, anexo,
      issRetidoFonte: parseMoney($id('issRetidoFonte').value),
      folhaMensal, aliquotaRAT
    });

    // DAS otimizado
    let dasOtim = null;
    try {
      dasOtim = calcularDASMensalOtimizado({
        receitaBrutaMensal: receitaMensal, rbt12, anexo, cnae, uf, municipio,
        receitaMonofasica: parseMoney($id('receitaMonofasica').value),
        receitaICMS_ST: parseMoney($id('receitaICMS_ST').value),
        receitaExportacao: parseMoney($id('receitaExportacao').value),
        receitaLocacaoBensMoveis: parseMoney($id('receitaLocacao').value),
        issRetidoFonte: parseMoney($id('issRetidoFonte').value),
        folhaMensal, aliquotaRAT
      });
    } catch (e) { dasOtim = null; }

    // ConsolidaÃ§Ã£o anual
    const meses = Array.from({ length: 12 }, () => ({
      receitaBrutaMensal: receitaMensal, rbt12, folhaSalarios12Meses: folha12,
      anexo, folhaMensal, issRetidoFonte: parseMoney($id('issRetidoFonte').value)
    }));
    const anual = calcularAnualConsolidado({ meses, socios, cnae, tipoAtividade: $id('tipoAtividade').value, aliquotaRAT });

    // ComparaÃ§Ã£o de regimes
    const comp = compararRegimesCompleto({
      receitaBrutaAnual: rbt12, folhaAnual: folha12, cnae, uf, municipio, fatorR,
      despesasOperacionais: despesas, socios
    });

    // Vantagens/Desvantagens
    const vanDesv = analisarVantagensDesvantagens({
      receitaBrutaAnual: rbt12, anexo, fatorR, localizacaoSUDAM: temSUDAM,
      vendeParaPJ: vendeB2B, folhaAnual: folha12, exporta
    });

    // DistribuiÃ§Ã£o de lucros
    const lucroContabil = $id('toggleEscrituracao').classList.contains('on') ? parseMoney($id('lucroContabil').value) : null;
    const distLucros = calcularDistribuicaoLucros({
      receitaBrutaAnual: rbt12, dasAnual: anual.dasAnual, socios,
      tipoAtividade: $id('tipoAtividade').value, lucroContabilEfetivo: lucroContabil
    });

    renderComparativo(comp, anual, aliqResult, dasMensal, dasOtim, anexo);
    renderRelatorioFinal(comp, anual, aliqResult, dasMensal, dasOtim, anexo, fatorR, vanDesv, distLucros, rbt12, folha12, receitaMensal, socios);

  } catch (e) {
    $id('resultadoComparativo').innerHTML = `<div class="info-card danger"><span class="ic-icon">âŒ</span><div><div class="ic-title">Erro no cÃ¡lculo</div>${e.message}</div></div>`;
    console.error(e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER: COMPARATIVO DE REGIMES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderComparativo(comp, anual, aliq, das, dasOtim, anexo) {
  let html = '';

  // Cards de resumo
  html += `<div class="section-title">Resultado do CÃ¡lculo <span class="st-sub">Anexo ${anexo}</span></div>`;
  html += `<div class="result-grid">
    <div class="result-card"><div class="rc-label">AlÃ­quota Efetiva</div><div class="rc-value">${aliq.aliquotaEfetivaFormatada}</div><div class="rc-sub">${aliq.faixaDescricao} â€¢ Nominal: ${aliq.aliquotaNominalFormatada}</div><div class="rc-ref">LC 123/2006, Art. 18, Â§1Âº</div></div>
    <div class="result-card"><div class="rc-label">DAS Mensal</div><div class="rc-value">${fmtBRL(das.dasAPagar)}</div><div class="rc-sub">Receita: ${fmtBRL(das.receitaBrutaMensal)}</div><div class="rc-ref">ResoluÃ§Ã£o CGSN 140/2018, Art. 21</div></div>
    <div class="result-card gold"><div class="rc-label">Carga TributÃ¡ria Anual</div><div class="rc-value">${fmtBRL(anual.cargaTributariaTotal)}</div><div class="rc-sub">${anual.percentualCargaFormatado} sobre a receita</div><div class="rc-ref">Inclui DAS + FGTS${anexo === 'IV' ? ' + INSS patronal' : ''}</div></div>`;

  if (dasOtim && dasOtim.economiaTotal > 0) {
    html += `<div class="result-card" style="--pri:#059669"><div class="rc-label">ğŸ’° Economia com OtimizaÃ§Ã£o</div><div class="rc-value text-ok">${fmtBRL(dasOtim.economiaTotal)}</div><div class="rc-sub">Por mÃªs â€¢ ${fmtBRL(dasOtim.economiaTotal * 12)} por ano</div><div class="rc-ref">DeduÃ§Ãµes legais aplicadas automaticamente</div></div>`;
  }
  html += '</div>';

  // Partilha de tributos
  html += `<div class="section-title">Partilha de Tributos no DAS <span class="st-sub">ResoluÃ§Ã£o CGSN 140/2018</span></div>`;
  html += `<div class="table-wrap"><table><thead><tr><th>Tributo</th><th>Sigla</th><th class="td-right">%</th><th class="td-right">Valor Mensal</th></tr></thead><tbody>`;
  const tribNomes = {
    irpj: ['IRPJ', 'Imposto de Renda Pessoa JurÃ­dica'],
    csll: ['CSLL', 'ContribuiÃ§Ã£o Social sobre o Lucro LÃ­quido'],
    cofins: ['COFINS', 'ContribuiÃ§Ã£o para Financiamento da Seguridade Social'],
    pis: ['PIS/PASEP', 'Programa de IntegraÃ§Ã£o Social'],
    cpp: ['CPP', 'ContribuiÃ§Ã£o PrevidenciÃ¡ria Patronal'],
    iss: ['ISS', 'Imposto Sobre ServiÃ§os'],
    icms: ['ICMS', 'Imposto sobre CirculaÃ§Ã£o de Mercadorias e ServiÃ§os'],
    ipi: ['IPI', 'Imposto sobre Produtos Industrializados']
  };
  for (const [k, v] of Object.entries(das.partilha)) {
    if (v && v.valor > 0) {
      const nm = tribNomes[k] || [k.toUpperCase(), ''];
      html += `<tr><td><span class="sigla" data-tip="${nm[1]}">${nm[0]}</span></td><td style="color:var(--txt3)">${nm[1]}</td><td class="td-right td-mono">${v.percentualFormatado}</td><td class="td-right td-mono fw-700">${fmtBRL(v.valor)}</td></tr>`;
    }
  }
  html += `</tbody></table></div>`;

  // Comparativo de regimes
  if (comp && comp.regimes) {
    html += `<div class="section-title">Comparativo de Regimes TributÃ¡rios <span class="st-sub">4 cenÃ¡rios</span></div>`;
    html += `<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin:16px 0">`;
    comp.regimes.forEach(r => {
      const isBest = r.melhorOpcao;
      html += `<div class="regime-card${isBest ? ' best' : ''}">
        <div class="regime-name">${r.ranking}Âº â€” ${r.regime}</div>
        <div class="regime-value">${fmtBRL(r.cargaTotal)}</div>
        <div class="regime-perc">${r.percentualCargaFormatado} sobre receita</div>
        <div class="regime-detail">
          Impostos: ${fmtBRL(r.dasOuImpostos)}<br>
          FGTS: ${fmtBRL(r.fgts)}<br>
          INSS Patronal: ${fmtBRL(r.inssPatronal)}
          ${r.observacoes ? '<br><em>' + r.observacoes.join(' â€¢ ') + '</em>' : ''}
        </div>
      </div>`;
    });
    html += '</div>';

    // Chart
    html += `<div class="chart-container"><canvas id="chartRegimes"></canvas></div>`;
  }

  $id('resultadoComparativo').innerHTML = html;

  // Render chart
  if (comp && comp.regimes) {
    setTimeout(() => {
      const ctx = document.getElementById('chartRegimes');
      if (ctx) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: comp.regimes.map(r => r.regime),
            datasets: [{
              label: 'Carga TributÃ¡ria Anual (R$)',
              data: comp.regimes.map(r => r.cargaTotal),
              backgroundColor: comp.regimes.map(r => r.melhorOpcao ? '#16a34a' : '#bbf7d0'),
              borderColor: comp.regimes.map(r => r.melhorOpcao ? '#15803d' : '#86efac'),
              borderWidth: 2, borderRadius: 6
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => fmtBRL(ctx.raw) } } },
            scales: { y: { beginAtZero: true, ticks: { callback: v => fmtBRL(v) } } }
          }
        });
      }
    }, 100);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER: RELATÃ“RIO FINAL (Etapa 7)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRelatorioFinal(comp, anual, aliq, das, dasOtim, anexo, fatorR, vanDesv, distLucros, rbt12, folha12, receitaMensal, socios) {
  let html = '';

  // Resumo executivo
  html += `<div class="section-title">Resumo Executivo <span class="st-sub">IMPOST. v4.1</span></div>`;
  html += `<div class="result-grid">
    <div class="result-card"><div class="rc-label">Empresa</div><div class="rc-value" style="font-size:16px">${$id('nomeEmpresa').value || 'NÃ£o informada'}</div><div class="rc-sub">${$id('cnae').value} â€¢ ${$id('uf').value}/${$id('municipio').value}</div></div>
    <div class="result-card"><div class="rc-label">Regime Atual</div><div class="rc-value" style="font-size:18px">Simples â€” Anexo ${anexo}</div><div class="rc-sub">Fator "r": ${(fatorR * 100).toFixed(2)}% â€¢ ${aliq.faixaDescricao}</div></div>
    <div class="result-card gold"><div class="rc-label">Melhor Regime</div><div class="rc-value" style="font-size:16px">${comp.melhorRegime}</div><div class="rc-sub">Economia vs pior: ${comp.economiaFormatada}</div></div>
  </div>`;

  // EstratÃ©gias
  html += `<div class="section-title">EstratÃ©gias para Menor Imposto <span class="st-sub">10 aÃ§Ãµes prioritÃ¡rias</span></div>`;
  if (typeof ESTRATEGIAS_MENOR_IMPOSTO !== 'undefined') {
    ESTRATEGIAS_MENOR_IMPOSTO.forEach(e => {
      html += `<div class="strategy-card">
        <div class="strategy-header">
          <span class="strategy-badge ${e.impacto}">${e.impacto}</span>
          <span class="strategy-title">${e.prioridade}. ${e.titulo}</span>
        </div>
        <div class="strategy-body">${e.descricao}
          <ul class="strategy-steps">${e.comoFazer.map(c => `<li>${c}</li>`).join('')}</ul>
          <div class="strategy-ref">ğŸ“– ${e.baseLegal} â€¢ Economia estimada: ${e.economiaEstimada}</div>
        </div>
      </div>`;
    });
  }

  // Riscos
  html += `<div class="section-title">Riscos Fiscais <span class="st-sub">LC 123/2006; ResoluÃ§Ã£o CGSN 140/2018</span></div>`;
  if (typeof RISCOS_FISCAIS !== 'undefined') {
    RISCOS_FISCAIS.forEach(r => {
      html += `<div class="risk-card ${r.gravidade}">
        <div class="risk-title">[${r.gravidade.toUpperCase()}] ${r.titulo}</div>
        <div class="risk-desc">${r.descricao}</div>
        <div class="risk-prev">âœ… PrevenÃ§Ã£o: ${r.prevencao}</div>
        <div class="risk-ref">ğŸ“– ${r.baseLegal}</div>
      </div>`;
    });
  }

  // DistribuiÃ§Ã£o de lucros
  html += `<div class="section-title">DistribuiÃ§Ã£o de Lucros Isenta <span class="st-sub">LC 123/2006, Art. 14</span></div>`;
  html += `<div class="result-grid">
    <div class="result-card"><div class="rc-label">Modalidade</div><div class="rc-value" style="font-size:14px">${distLucros.modalidadeUtilizada}</div><div class="rc-sub">PresunÃ§Ã£o: ${distLucros.percentualPresuncaoFormatado}</div></div>
    <div class="result-card gold"><div class="rc-label">Lucro DistribuÃ­vel Isento</div><div class="rc-value">${fmtBRL(distLucros.lucroDistribuivelFinal)}</div><div class="rc-sub">Anual â€¢ Isento de IRPF</div><div class="rc-ref">LC 123/2006, Art. 14; RIR/2018, Art. 145</div></div>
  </div>`;
  if (distLucros.porSocio && distLucros.porSocio.length > 0) {
    html += `<div class="table-wrap"><table><thead><tr><th>SÃ³cio</th><th>ParticipaÃ§Ã£o</th><th class="td-right">Valor Isento Anual</th></tr></thead><tbody>`;
    distLucros.porSocio.forEach(s => {
      html += `<tr><td>${s.nome}</td><td>${s.percentualFormatado}</td><td class="td-right td-mono fw-700">${s.valorIsentoFormatado}</td></tr>`;
    });
    html += '</tbody></table></div>';
  }

  // ObrigaÃ§Ãµes acessÃ³rias
  html += `<div class="section-title">ObrigaÃ§Ãµes AcessÃ³rias <span class="st-sub">LC 123/2006, Arts. 25 e 26</span></div>`;
  html += '<div class="obrig-grid">';
  if (typeof OBRIGACOES_ACESSORIAS !== 'undefined') {
    OBRIGACOES_ACESSORIAS.forEach(o => {
      html += `<div class="obrig-card">
        <div class="obrig-name"><span class="sigla" data-tip="${o.descricao}">${o.nome}</span></div>
        <div class="obrig-period">ğŸ“… ${o.periodicidade}</div>
        <div class="obrig-prazo">â° ${o.prazo}</div>
        <div class="obrig-ref">${o.baseLegal}</div>
      </div>`;
    });
  }
  html += '</div>';

  // TransiÃ§Ã£o de regimes
  html += `<div class="section-title">Procedimentos de TransiÃ§Ã£o <span class="st-sub">Se necessÃ¡rio mudar de regime</span></div>`;
  if (typeof TRANSICOES !== 'undefined') {
    for (const [key, t] of Object.entries(TRANSICOES)) {
      html += `<div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion(this)">${t.descricao}<span class="arrow">â–¼</span></div>
        <div class="accordion-body">
          <p style="margin-bottom:8px;font-size:13px"><strong>Procedimentos:</strong></p>
          <ol style="padding-left:20px;font-size:13px;color:var(--txt2)">${t.procedimentos.map(p => `<li style="margin:4px 0">${p}</li>`).join('')}</ol>
          <p style="margin:10px 0 6px;font-size:13px"><strong>Alertas:</strong></p>
          <ul style="padding-left:20px;font-size:13px;color:var(--warn)">${t.alertas.map(a => `<li style="margin:4px 0">${a}</li>`).join('')}</ul>
          <p style="font-size:11px;color:var(--txt3);font-style:italic;margin-top:8px">ğŸ“– ${t.baseLegal}</p>
        </div>
      </div>`;
    }
  }

  // Selo final
  html += `<div style="text-align:center;margin-top:36px;padding:28px;background:var(--pri-50);border-radius:var(--radius);border:1px solid var(--pri-200)">
    <div style="font-size:28px;font-weight:800;color:var(--pri-dk);letter-spacing:-1px">IMPOST<span style="color:var(--accent)">.</span></div>
    <div style="font-size:13px;color:var(--txt2);margin-top:4px">RelatÃ³rio de OtimizaÃ§Ã£o TributÃ¡ria ConcluÃ­do</div>
    <div style="font-size:12px;color:var(--txt3);margin-top:8px">Gerado em ${new Date().toLocaleDateString('pt-BR')} Ã s ${new Date().toLocaleTimeString('pt-BR')}</div>
    <div style="font-size:11px;color:var(--txt3);margin-top:4px;font-style:italic">Este estudo tem carÃ¡ter informativo e nÃ£o substitui orientaÃ§Ã£o contÃ¡bil profissional.</div>
  </div>`;

  $id('relatorioFinal').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INICIALIZAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  // Popular lista de produtos monofÃ¡sicos
  if (typeof PRODUTOS_MONOFASICOS !== 'undefined') {
    const ml = $id('monoList');
    let h = '<table style="width:100%;font-size:12.5px"><thead><tr><th>Categoria</th><th>Tributos Concentrados</th><th>Base Legal</th></tr></thead><tbody>';
    PRODUTOS_MONOFASICOS.forEach(p => {
      h += `<tr><td>${p.categoria}</td><td>${p.tributosConcentrados.join(', ')}</td><td style="color:var(--txt3);font-style:italic">${p.baseLegal}</td></tr>`;
    });
    h += '</tbody></table>';
    ml.innerHTML = h;
  }
});
</script>
</body>
</html>
